{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">⚙️ AI Control Panel</h2>
<p>Enable or disable AI automation features in real time.</p>

<!-- ⭐ Run AI Engine Button ⭐ -->
<button class="btn btn-primary mb-4" onclick="runAiNow()">⚡ Run AI Engine Now</button>

<!-- SETTINGS LIST -->
<div class="list-group">

  {% for key, value in settings.items() %}
  <div class="list-group-item d-flex justify-content-between align-items-center">
    <strong>{{ key.replace("_", " ").title() }}</strong>

    <div class="form-check form-switch">
      <input class="form-check-input"
             type="checkbox"
             id="{{ key }}"
             {% if value %} checked {% endif %}
             onchange="toggleSetting('{{ key }}')">
    </div>
  </div>
  {% endfor %}

</div>

<!-- TOGGLE SETTING FUNCTION -->
<script>
function toggleSetting(key) {
    let value = document.getElementById(key).checked;

    fetch("/api/ai/settings/update", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ key: key, value: value })
    })
    .then(r => r.json())
    .then(data => {
        console.log("Setting updated:", data);
    });
}
</script>

<!-- RUN AI ENGINE NOW -->
<script>
function runAiNow() {
    fetch("/api/ai/run", {
        method: "POST"
    })
    .then(res => res.json())
    .then(data => {
        alert("AI Engine Executed:\n\n" + JSON.stringify(data.results, null, 2));
    });
}
</script>
<div class="alert alert-warning">
  <strong>Live Mode:</strong>  
  When ON, AI will make REAL changes (repricing, listings, etc).
</div>

<div class="list-group-item d-flex justify-content-between align-items-center bg-danger text-white">
  <strong>LIVE MODE</strong>

  <div class="form-check form-switch">
    <input class="form-check-input"
           type="checkbox"
           id="live_mode"
           {% if settings.live_mode %} checked {% endif %}
           onchange="toggleSetting('live_mode')">
  </div>
</div>

<hr>
{% endblock %}
